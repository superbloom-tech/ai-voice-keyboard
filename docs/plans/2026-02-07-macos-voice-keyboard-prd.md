# macOS AI 语音输入法（v0.1）PRD

## 目标

做一个 **AI 驱动的语音输入工具**（macOS 优先），满足输入法场景的低时延要求：

- 语音转文字（STT）+ 轻量级润色（去犹豫/口头禅/重复，尽量不改变语义）
- 支持“选中文本 -> 语音下编辑指令 -> 预览对比 -> 确认替换”
- STT 与 LLM 都允许用户自行配置 API（多 Provider 适配；Apple Speech 不需要 API）

## 用户流程

### Insert（语音输入）

1. 按 Insert 快捷键开始收音
2. 再按一次结束收音
3. STT 得到文本（可显示实时 partial）
4. 本地轻清理 +（可选）LLM 轻量润色（超时自动降级）
5. 写入当前光标位置（优先用剪贴板 + Cmd+V；并恢复原剪贴板）

### Edit（语音编辑）

1. 用户先用光标选中一段文本
2. 按 Edit 快捷键开始收音
3. 再按一次结束收音，STT 得到“编辑指令”
4. LLM 根据 {选区原文 + 指令} 产出改写稿
5. 弹出预览对比：确认替换 / 取消 / 复制改写稿

## 关键需求

### 1) 菜单栏图标随状态变化

- Idle / Recording(Insert) / Recording(Edit) / Processing / Preview / Error
- 深色模式兼容；采用 template icon

### 2) 最近历史（仅本 App 产生）

- 记录每次 Insert/Edit 的：时间、模式、原始转写、最终文本（或改写稿）、耗时与降级原因（如有）
- 历史列表每条支持“一键复制”
- 当插入/替换需要临时覆盖剪贴板时，必须保存“覆盖前剪贴板快照”到历史，支持一键恢复/复制

### 3) Provider 可配置

- STT Provider：Apple Speech（默认）+（后续）云端 STT（用户自配）
- LLM Provider：用户自配（支持 baseURL / key / model 等）

## 非目标（v0.1）

- 真正的系统输入法（Input Source）
- 富文本保留（样式、链接等）
- 云同步、账号体系、收费体系

## 性能指标（目标）

- 录音期间：partial 更新节奏 <= 300ms（视引擎而定）
- 停止录音后到可落字/可预览：P50 <= 1.5s，P95 <= 3s（允许降级）
- LLM 润色超时默认 1200ms：超时则直接使用本地清理结果

